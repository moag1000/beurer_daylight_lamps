# ESP32-S3 Bluetooth Proxy for Beurer Daylight Lamps
# =====================================================
#
# IMPORTANT: The Beurer TL100 does NOT support BLE 5.0 PHY negotiation!
# Standard Bluetooth Proxy configs will fail with error 0x3e.
#
# HARDWARE COMPATIBILITY:
#   ESP32-S3:     ✅ Recommended (dual-core Xtensa)
#   ESP32-WROOM:  ✅ Works (dual-core Xtensa)
#   ESP32-C3:     ❌ Does NOT work (single-core RISC-V)
#   ESP32-C6:     ❌ Does NOT work (single-core RISC-V)
#
# SETUP:
#   1. Copy this file and rename to btproxy-beurer.yaml
#   2. Create a secrets.yaml file (see bottom of this file)
#   3. Adjust board type if using different hardware
#   4. Flash via ESPHome Dashboard or CLI

esphome:
  name: btproxy-beurer
  friendly_name: BT Proxy Beurer

esp32:
  board: esp32-s3-devkitc-1
  variant: esp32s3
  framework:
    type: esp-idf
    version: recommended
    sdkconfig_options:
      # ====================================================================
      # CRITICAL: Disable BLE 5.0 for Beurer TL100 compatibility
      # Without this, connections fail with error 0x3e
      # ====================================================================
      CONFIG_BT_BLE_50_FEATURES_SUPPORTED: n
      CONFIG_BT_BLE_42_FEATURES_SUPPORTED: y

      # WiFi/BLE Coexistence (Dual-Core)
      CONFIG_SW_COEXIST_ENABLE: y
      CONFIG_SW_COEXIST_PREFERENCE_BT: y

      # BLE Connection Parameters
      CONFIG_BT_ACL_CONNECTIONS: "3"
      CONFIG_BT_GATT_MAX_SR_PROFILES: "8"

      # Dual-Core: Pin BT to Core 0, WiFi uses Core 1
      CONFIG_BT_BLUEDROID_PINNED_TO_CORE: "0"

logger:
  level: DEBUG

api:
  encryption:
    key: !secret api_encryption_key

ota:
  - platform: esphome
    password: !secret ota_password

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  power_save_mode: none

  ap:
    ssid: "BT-Proxy-Fallback"
    password: !secret fallback_password

captive_portal:

esp32_ble:

esp32_ble_tracker:
  scan_parameters:
    # Match Beurer LightUp App scan parameters
    interval: 60ms
    window: 30ms
    active: true
    continuous: true

bluetooth_proxy:
  active: true
  cache_services: false  # Disable cache for fresh connections

# ====================================================================
# SECRETS.YAML - Create this file with your actual credentials:
# ====================================================================
#
# wifi_ssid: "YourWiFiNetwork"
# wifi_password: "YourWiFiPassword"
# api_encryption_key: "generate-with-esphome-wizard"
# ota_password: "your-secure-ota-password"
# fallback_password: "fallback-ap-password"
#
# Generate API key: esphome wizard or use any 32-byte base64 string
# ====================================================================
